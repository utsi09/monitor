<root BTCPP_format="4">
    <BehaviorTree ID="MainTree">
        <Sequence name="MainLoop">
            
            <Parallel name="Subscribers" success_count="2" failure_count="1">

                <Action ID="VelSubscriber"
                topic_name="/vel"
                vel_x="{@vel_x}"
                vel_y="{@vel_y}"/>

                <Action ID="HeadingSubscriber"
                topic_name="/heading"
                current_heading="{@current_heading}"/>

                <Action ID="ObstacleSubscriber"
                topic_name="/hesai_zed/obstacles"
                obstacles="{@nearest_obstacle}"/>

            </Parallel>

            <Action ID="UpdateSystemState"
                    vel_x="{@vel_x}"
                    vel_y="{@vel_y}"
                    current_heading="{@current_heading}"
                    important_sensors="{@important_sensors}"/>

            <Action ID="CalculateFTTI"
                    obstacles="{@obstacles}"
                    important_sensors="{@important_sensors}"
                    
                    lidar_ftti="{@lidar_ftti}"
                    cam_ftti="{@cam_ftti}"
                    imu_ftti="{@imu_ftti}"
                    gps_ftti="{@gps_ftti}"
                    />

            <Parallel name="SensorChecks" success_count="4" failure_count="1">
                <Action ID="LidarChecker" name="LidarChecker" lidar_timeout="{@lidar_timeout}"/>
                <Action ID="CamChecker" name="CamChecker" topic_name="/zed/zed_node/rgb/color/rect/image/compressed" cam_timeout="{@cam_timeout}"/>
                <Action ID="ImuChecker" name="ImuChecker"    topic_name="/imu/data" imu_timeout="{@imu_timeout}"/>
                <Action ID="GpsChecker" name="GpsChecker"    topic_name="/fix" gps_timeout="{@gps_timeout}"/> 
            </Parallel>

            <!-- <Action ID="CalculateFTTI"
                    in_speed="{@current_vel}"/> -->
            
        </Sequence>
    </BehaviorTree>
</root>